---
# defaults file for ansible-redis

    ## Installation options
    redis_install_enabled: true
    config_redis_enabled: true
    config_newrelic_enabled: true
    ## REDIS
    redis_version: 6.2.3
    redis_install_dir: /opt/redis
    redis_dir: "/data/{{ redis_port }}"
    redis_config_file_name: "{{ redis_service_name }}.conf"
    redis_download_url: "http://download.redis.io/releases/redis-{{ redis_version }}.tar.gz"
    redis_reboot_allowed: true
    # Set this to true to validate redis tarball checksum against vars/main.yml
    redis_verify_checksum: false
    # Set this value to a local path of a tarball to use for installation instead of downloading
    redis_tarball: false
    # Set this to true to build 32-bit binaries of Redis
    redis_make_32bit: false
    redis_user: redis
    redis_group: "{{ redis_user }}"
    # The open file limit for Redis/Sentinel
    redis_nofile_limit: 20480
    redis_oom_score_adj: "no"
    redis_oom_score_adj_values: "0 200 800"
    ## Role options
    # Configure Redis as a service
    # This creates the init scripts for Redis and ensures the process is running
    # Also applies for Redis Sentinel
    redis_as_service: true
    # Add local facts to /etc/ansible/facts.d for Redis
    redis_local_facts: false
    # Service name
    redis_service_name: "redis_{{ redis_port }}"
    redis_protected_mode: "yes"
    ## Networking/connection options
    redis_bind: false
    redis_port: 6379
    redis_password: "{{ lookup('env', 'REDIS_PASSWORD') | default(false,True) }}"
    # Slave replication options
    redis_min_slaves_to_write: 0
    redis_min_slaves_max_lag: 10
    redis_tcp_backlog: 511
    redis_tcp_keepalive: 300
    # Max connected clients at a time
    redis_maxclients: 10000
    redis_timeout: 0
    # Socket options
    # Set socket_path to the desired path to the socket. E.g. /var/run/redis/{{ redis_port }}.sock
    redis_socket_path: false
    redis_socket_perm: 755
    # ## Replication options
    # # Set slaveof just as you would in redis.conf. (e.g. "redis01 6379")
    # redis_slaveof: false
    # # Make slaves read-only. "yes" or "no"
    # redis_slave_read_only: "yes"
    # redis_slave_priority: 100
    # redis_repl_backlog_size: false
    redis_newrelic_env: "acquirer-redis-stg"
    ## Logging
    redis_logfile: "/var/log/redis/{{ redis_service_name }}.log"
    redis_logrotate_policy: weekly
    redis_logrotate_rotate: 52
    # Enable syslog. "yes" or "no"
    redis_syslog_enabled: "no"
    redis_syslog_ident: "{{ redis_service_name }}"
    # Syslog facility. Must be USER or LOCAL0-LOCAL7
    redis_syslog_facility: USER
    ## General configuration
    redis_daemonize: "no"
    redis_supervised: "systemd"
    redis_pidfile: "/var/run/{{ redis_service_name }}.pid"
    redis_acl_file_name: "{{ redis_service_name }}.acl"
    # Number of databases to allow
    redis_databases: 16
    redis_loglevel: notice
    redis_always_show_logo: "no"
    # Log queries slower than this many milliseconds. -1 to disable
    redis_slowlog_log_slower_than: 10000
    # Maximum number of slow queries to save
    redis_slowlog_max_len: 128
    # Redis memory limit (e.g. 4294967296, 4096mb, 4gb)
    redis_maxmemory: 5632mb
    redis_maxmemory_policy: allkeys-lru
    redis_maxmemory_samples: 10
    redis_rename_commands: []
    # Lua script time limit
    redis_lua_time_limit: 5000
    # the file name for the RDB Backup
    redis_dbfilename: "dump_{{ redis_port }}.rdb"
    # How frequently to snapshot the database to disk
    # e.g. "900 1" => 900 seconds if at least 1 key changed
    redis_save:
      - 900 1
      - 300 10
      - 60 1000
      - 30 10000
    redis_stop_writes_on_bgsave_error: "yes"
    redis_rdbcompression: "yes"
    redis_rdbchecksum: "yes"
    redis_appendonly: "yes"
    redis_appendfilename: "appendonly_{{ redis_port }}.aof"
    redis_appendfsync: "everysec"
    redis_no_appendfsync_on_rewrite: "yes"
    redis_auto_aof_rewrite_percentage: "50"
    redis_auto_aof_rewrite_min_size: "3072mb"
    redis_notify_keyspace_events: '""'
    redis_client_output_buffer_limit_normal: 0 0 0
    redis_client_output_buffer_limit_replica: 256mb 64mb 60
    redis_client_output_buffer_limit_pubsub: 32mb 8mb 60
    redis_hz: 10
    redis_dynamic_hz: "yes"
    redis_activerehashing: "yes"
    ## Additional configuration options
    # leave empty if not required. Use a block style scalar to add options, e.g.
    # redis_config_additional: |
    #   io-threads 4
    #   io-threads-do-reads yes
    redis_config_additional: ""

    redis_build_dep_packages:
      [make, gcc, tcl, systemd-devel, openssl-devel, centos-release-scl]
    redis_sysctl_fixes:
      net.core.somaxconn: 65535